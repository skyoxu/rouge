[
  {
    "id": "GM-0101",
    "story_id": "PRD-GUILD-MANAGER-CORE-EVENT-ENGINE",
    "title": "实现公会管理器事件引擎核心（EventEngine Core）",
    "description": "基于 PRD-Guild-Manager 核心循环（Resolution/Player/AI Simulation）与 Phase-9/Phase-6 设计，在 Game.Core 中实现 EventEngine 核心：负责回合/周循环驱动、事件条件评估、事件执行与冲突解决，作为公会管理垂直切片的事件中枢。",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "depends_on": [
      "NG-0020"
    ],
    "adr_refs": [
      "ADR-0018",
      "ADR-0004",
      "ADR-0006",
      "ADR-0007",
      "ADR-0005",
      "ADR-0024"
    ],
    "chapter_refs": [
      "CH01",
      "CH04",
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-功能纵切-公会管理器.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "core",
      "event-engine",
      "guild",
      "simulation"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core.Tests/Domain/EventEngineTests.cs"
    ],
    "acceptance": [
      "Game.Core 中存在 EventEngine 类（或等价聚合根），负责驱动回合/周循环并对外暴露明确的 API（如 ExecuteResolutionPhase/ExecutePlayerPhase/ExecuteAiPhase）。",
      "事件引擎能够接受一组领域事件定义（来自 Contracts 或 Domain 类型），根据当前游戏状态评估触发条件，并执行对应效果。",
      "事件冲突解决规则在 EventEngine 中有清晰实现（如优先级、排他性、合并策略），并在 xUnit 测试中覆盖。",
      "Game.Core.Tests/Domain/EventEngineTests.cs 中存在针对回合循环、条件评估、事件执行、冲突解决的单元测试，全部通过。",
      "EventEngine 不直接依赖 Godot API；与 Godot 的集成通过适配层/Signals 完成（见 NG-0020/NG-0014）。",
      "EventEngine 至少支持上述三类 Guild 领域事件的基本调度：在 Resolution/Player/AI Simulation 周期内能够消费和发布 GuildCreated、GuildMemberJoined、GuildMemberLeft 等事件，对应的行为由 Game.Core.Tests/Domain/EventEngineTests.cs 及相关用例覆盖。"
    ],
    "test_strategy": [
      "按 PRD 中定义的核心循环（Resolution/Player/AI Simulation）为 EventEngine 设计一组最小测试场景，用 xUnit 验证每个阶段的状态变更是否符合预期。",
      "为常见事件类型（如成员加入、资源变化、活动结算）设计条件/效果组合，在测试中模拟不同初始状态并验证 EventEngine 输出。",
      "为冲突场景（多个事件作用于同一实体或互斥条件）编写专门测试，确认 EventEngine 能按预期顺序/规则处理。"
    ],
    "taskmaster_id": 3,
    "taskmaster_exported": true
  },
  {
    "id": "GM-0102",
    "story_id": "PRD-GUILD-MANAGER-CORE-AI-COORDINATOR",
    "title": "实现 AI 协调器（AICoordinator）管理 NPC 公会与成员行为",
    "description": "在 Game.Core 中实现 AICoordinator（或等价组件），负责管理 NPC 公会和成员 AI：处理 AI 周期、关系网络更新、冲突解决与 AI 事件生成，并通过接口向 EventEngine 与 Godot 适配层暴露能力，支撑 PRD-Guild-Manager 中“生态模拟与多主体 AI”要求。",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "depends_on": [
      "NG-0020",
      "GM-0101"
    ],
    "adr_refs": [
      "ADR-0018",
      "ADR-0004",
      "ADR-0007",
      "ADR-0005",
      "ADR-0015"
    ],
    "chapter_refs": [
      "CH01",
      "CH04",
      "CH05",
      "CH06",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-功能纵切-公会管理器.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "core",
      "ai",
      "simulation",
      "guild"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core.Tests/Domain/AICoordinatorTests.cs"
    ],
    "acceptance": [
      "Game.Core 中存在 AICoordinator 类（或等价服务），负责在每个 AI 周期内驱动 NPC 公会与成员行为（决策、关系更新、事件生成）。",
      "AICoordinator 对外暴露用于集成的接口（如 StepAiCycle/GenerateAiEvents），供 EventEngine 或 Godot 适配层调用。",
      "xUnit 测试涵盖基本 AI 行为（例如简单策略下的成员状态变化）、冲突场景（多个 NPC 目标冲突）以及性能边界（在模拟大量 NPC 时仍保持可接受性能）。",
      "如采用多线程/ThreadPool 优化 AI 计算，AICoordinator 提供线程安全保证，并在测试中验证无竞态条件。"
    ],
    "test_strategy": [
      "为小规模 NPC 集合设计 AI 周期测试，用 xUnit 验证行为决策与状态更新是否符合 PRD 中定义的规则。",
      "构造典型冲突场景（例如资源争抢、公会关系冲突），验证 AICoordinator 能生成合理事件并与 EventEngine 协同处理。",
      "在测试环境中逐步增加 NPC 数量，测量 AICoordinator 的执行时间，以便后续与 ADR-0015 的性能预算对齐。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "GM-0103",
    "story_id": "PRD-GUILD-MANAGER-CORE-GAME-LOOP",
    "title": "实现公会管理器核心回合循环与时间推进（Game Loop）",
    "description": "根据 PRD-Guild-Manager 3.0 核心游戏循环设计，在 Game.Core 中实现公会管理器的回合/周循环与时间推进逻辑，并在 Godot 场景中通过 UI 反馈当前周次/阶段/时间进度，支撑首个垂直切片的完整“Resolution→Player→AI Simulation”回合体验。",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "depends_on": [
      "NG-0020",
      "GM-0101"
    ],
    "adr_refs": [
      "ADR-0018",
      "ADR-0004",
      "ADR-0006",
      "ADR-0024"
    ],
    "chapter_refs": [
      "CH01",
      "CH04",
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-功能纵切-公会管理器.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "core",
      "game-loop",
      "time",
      "guild"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core.Tests/Domain/GameLoopTests.cs",
      "Tests.Godot/tests/Scenes/test_guild_main_scene.gd",
      "Game.Core.Tests/Domain/GameTurnSystemTests.cs",
      "Tests.Godot/tests/Scenes/test_main_scene_smoke.gd",
      "Tests.Godot/tests/Scenes/Guild/T2PlayableSceneTests.gd"
    ],
    "acceptance": [
      "Game.Core 中存在表示游戏周次/阶段/时间的核心类型与服务（例如 GameTurnSystem 或等价接口），并实现 PRD 中定义的三阶段回合循环。",
      "游戏时间推进逻辑能够驱动 EventEngine 与 AICoordinator，在至少一个简单场景中完成从 Resolution → Player → AI Simulation 的完整一周循环。",
      "Godot 主场景 UI 能够显示当前周次/阶段/时间状态，并在回合推进时实时更新。",
      "Game.Core.Tests 中存在 GameLoopTests（或等价），覆盖时间推进、阶段切换以及回合边界条件；Tests.Godot 中有用例验证 UI 与 Core 状态同步。",
      "Game.Core 与 Godot 场景的组合至少能够完成 PRD 3.0.3 T2 可玩性场景流中描述的一次完整循环：从启动主场景进入首周公会管理界面，执行一次完整的 Resolution→Player→AI Simulation 一周循环，并安全返回主菜单或结束会话；对应的 xUnit 和 GdUnit4/headless 用例挂接在 NG-0021 的 test_refs 中并在 CI 中保持绿灯。",
      "GM-0103 所需的 T2 流程最小测试入口已经落在 Game.Core.Tests/Domain/GameLoopTests.cs 与 Tests.Godot/tests/Scenes/Guild/T2PlayableSceneTests.gd；后续扩展测试应在此基础上补充，而不是新建平行入口文件。"
    ],
    "test_strategy": [
      "在 xUnit 中为 GameLoop 设计一组“单周循环”用例，验证每个阶段的调用顺序与状态变化是否符合 PRD 描述。",
      "在 GdUnit4 中为主场景编写测试，通过模拟回合推进（调用 public 方法或连接信号）检查 UI 显示是否与 Core 状态一致。",
      "结合 GM-0101/GM-0102，用一个最小的“公会一周生活”场景验证事件触发、AI 行为与 UI 反馈闭环。"
    ],
    "taskmaster_id": 4,
    "taskmaster_exported": true
  }
]