[
  {
    "id": "NG-0001",
    "story_id": "PRD-NEWGUILD-VS-0001",
    "title": "整理 newguild 首个垂直切片 PRD 与 Overlay 映射",
    "description": "基于现有 ADR 与 Phase 文档，为 newguild 定义首个可玩的垂直切片（例如基础公会管理循环），并将 Story 对齐到 PRD-<PRODUCT> / overlays/08 中的功能纵切文档。产出：一份最小 PRD 片段、对应 overlays 目录与 Test-Refs 协议。",
    "status": "pending",
    "priority": "P1",
    "layer": "docs",
    "depends_on": [],
    "adr_refs": [
      "ADR-0018",
      "ADR-0004",
      "ADR-0005",
      "ADR-0023",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH01",
      "CH04",
      "CH05",
      "CH06",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-Guild-Manager/08/_index.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-功能纵切-公会管理器.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "vertical-slice",
      "docs",
      "architecture"
    ],
    "owner": "architecture",
    "test_refs": [],
    "acceptance": [
      "存在一份针对 newguild 的最小 PRD 片段（含输入/输出/状态/存储与非功能约束），并显式引用 ADR-0018/0004/0005/0023/0011。",
      "在 overlays/PRD-*/08 下新增或调整功能纵切文档，严格遵守 08 章只引用 01/02/03 口径的规则（不复制阈值）。",
      "每个 Story 至少关联一条 Test-Ref（xUnit 或 GdUnit4），并在文档脚注中列出。"
    ],
    "test_strategy": [
      "文档审阅：由架构负责人确认 PRD 与 ADR/Phase 一致性。",
      "链接校验：任务/回链校验脚本通过（task-links-validate）。"
    ],
    "taskmaster_id": 1,
    "taskmaster_exported": true
  },
  {
    "id": "NG-0012",
    "story_id": "PH12-BACKLOG-B1-B2",
    "title": "Python 版 headless smoke 封装与 strict 模式开关",
    "description": "根据 Phase-12-Headless-Smoke-Backlog.md B1/B2，在当前 Godot + C# 模板中实现 Python 版 headless smoke 封装脚本（替代/补充 PowerShell 版本），并增加 strict 模式：严格依赖 [TEMPLATE_SMOKE_READY]/[DB] opened marker 决定通过与否。",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "depends_on": [
      "NG-0001"
    ],
    "adr_refs": [
      "ADR-0005",
      "ADR-0011",
      "ADR-0018",
      "ADR-0024"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "ci",
      "smoke",
      "godot",
      "python",
      "headless"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/ci/<date>/smoke/headless.log",
      "logs/ci/<date>/smoke/selfcheck-summary.json"
    ],
    "acceptance": [
      "新增 scripts/python/smoke_headless.py（或等价脚本），支持 --godot-bin/--scene/--timeout-sec/--project-path 参数，并在 Windows 上可直接运行。",
      "非 strict 模式下，脚本行为与现有 PowerShell 版本等价，输出写入 logs/ci/<date>/smoke/**，并保留宽松判定。",
      "strict 模式下，仅当日志包含 [TEMPLATE_SMOKE_READY] 或 [DB] opened 时返回 0，否则返回非零并在日志中标记为 strict-failed。",
      "ci-windows.yml 或 windows-quality-gate.yml 至少提供一条注释示例，展示如何在受保护分支启用 strict 模式。"
    ],
    "test_strategy": [
      "本地运行：在 Windows 环境下通过 dev_cli.py 调用 Python 版 smoke，验证日志与退出码。",
      "CI 演练：在非受保护分支上打开 strict 模式，观察 smoke 失败时的门禁行为与日志输出。"
    ],
    "taskmaster_id": 5,
    "taskmaster_exported": true
  },
  {
    "id": "NG-0013",
    "story_id": "PH13-BACKLOG-B1-B2-B5",
    "title": "扩展 quality_gates.py 覆盖率阈值与 GdUnit4 集成",
    "description": "承接 Phase-13-Quality-Gates-Script.md 与 Backlog：将 xUnit 覆盖率门禁提升到蓝图标准（行≥90%、分支≥85%，可由环境变量覆盖），并把关键 GdUnit4 集合（Adapters+Security 小集）通过 quality_gates.py 聚合输出到统一 summary，以便在 CI 中统一判定。",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "depends_on": [
      "NG-0012"
    ],
    "adr_refs": [
      "ADR-0005",
      "ADR-0015",
      "ADR-0018",
      "ADR-0024"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "ci",
      "quality-gates",
      "coverage",
      "gdunit"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/ci/<date>/unit/coverage.json",
      "logs/e2e/<date>/gdunit-hard/run-summary.json",
      "logs/ci/<date>/quality-gates-summary.json"
    ],
    "acceptance": [
      "scripts/python/run_dotnet.py 读取覆盖率结果并在 summary.json 中写入 lines/branches 与阈值配置（默认 90/85，可由环境变量覆盖）。",
      "当覆盖率低于阈值时，quality_gates.py 在 summary 中标记为 failed，并可配置为软/硬门禁（至少支持硬门禁）。",
      "quality_gates.py 能调用 run_gdunit.py 或等价封装，执行 Adapters+Security 硬门禁集合，并在 quality-gates-summary.json 中汇总结果。",
      "Windows Quality Gate 工作流调用 quality_gates.py all 时，能在 Step Summary 中清晰展示 dotnet 覆盖率与 GdUnit4 集合结果。"
    ],
    "test_strategy": [
      "本地模拟：手工降低测试覆盖率，验证 quality_gates.py 将其标记为 failed，并按配置返回非零 exit code。",
      "CI 验证：在 PR 上运行 windows-quality-gate 工作流，观察 coverage 与 GdUnit4 结果是否在 Step Summary 与 artifacts 中正确展示。"
    ],
    "taskmaster_exported": true,
    "taskmaster_id": 7
  },
  {
    "id": "NG-0014",
    "story_id": "PH14-BACKLOG-B1-B2-B3-B4",
    "title": "Godot 安全适配层增强：外链白名单、文件访问与 OS.execute 守卫",
    "description": "按照 Phase-14-Godot-Security-Baseline.md 与 Backlog，对当前 Godot+C# 模板补齐安全适配层：统一外链白名单配置（ALLOWED_EXTERNAL_HOSTS）、文件访问适配（仅 res:// 与 user://，拒绝 .. 和绝对路径）、显式封装 OS.execute，并为安全审计 JSONL 增加格式校验与最小测试集。",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "depends_on": [
      "NG-0001"
    ],
    "adr_refs": [
      "ADR-0019",
      "ADR-0006",
      "ADR-0005",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH02",
      "CH05",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "security",
      "godot",
      "adapter",
      "filesystem",
      "process"
    ],
    "owner": "architecture",
    "test_refs": [
      "Tests.Godot/tests/Security/Hard/test_db_path_rejection.gd",
      "Tests.Godot/tests/Security/Hard/test_settings_config_security.gd",
      "logs/ci/<date>/security-audit.jsonl"
    ],
    "acceptance": [
      "外链访问统一通过 SecurityUrlAdapter（或等价组件）完成，强制 https scheme + ALLOWED_EXTERNAL_HOSTS 白名单，禁止 file://、javascript: 等高危 scheme。",
      "SecurityUrlAdapter 在引入 ALLOWED_EXTERNAL_HOSTS 白名单（可通过环境变量或配置）时，默认开启安全收敛：当 allowedDomains == null 时不会在生产环境下“全部放行”，而是保持本地/测试环境明确配置或显式 opt-in，符合 ADR-0019 对外链白名单的防御性要求。",
      "文件访问统一通过 SecurityFileAdapter（或等价组件）封装 FileAccess/DirAccess：仅允许 res:// 读取与 user:// 读写，拒绝绝对路径与 .. 越权访问，并将拒绝写入 security-audit.jsonl。",
      "OS.execute 默认在运行时禁用，或仅在开发/CI 模式通过 SecurityProcessAdapter 白名单执行，并记录审计日志。",
      "安全审计 JSONL（logs/ci/<date>/security-audit.jsonl 与 user://logs/security/**）均通过验证脚本检查：每行合法 JSON，至少包含 {ts, action, reason, target, caller} 字段。",
      "相关 GdUnit4 Hard 测试覆盖允许/拒绝/非法三态场景，并在 CI 中作为硬门禁的一部分。"
    ],
    "test_strategy": [
      "GdUnit4 安全用例：编写/扩展 Hard 集测试外链、文件、进程三类接口的 allow/deny/invalid 行为。",
      "脚本校验：新增或扩展 scripts/python/validate_audit_logs.py，针对 security-audit.jsonl 做格式与字段校验，在 CI 中运行。"
    ],
    "taskmaster_exported": true,
    "taskmaster_id": 8,
    "contract_refs": [
      "security.url_access.denied",
      "security.file_access.denied",
      "security.process.denied"
    ]
  },
  {
    "id": "NG-0015",
    "story_id": "PH15-BACKLOG-B1-B2",
    "title": "在 Game.Core 落地性能追踪库并接入 CI 性能门禁",
    "description": "根据 Phase-15-Performance-Budgets-and-Gates.md 与 ADR-0015，在 Game.Core 中实现纯 C# 性能追踪库（PerformanceTracker/PerformanceMetrics/QueryPerformanceTracker），计算 P50/P95 等指标并生成 JSON 报告；在脚本层新增性能门禁聚合脚本，将 PerfTracker 输出与预算阈值（环境变量可配置）联动，写入 logs/perf 与 logs/ci。",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "depends_on": [
      "NG-0013"
    ],
    "adr_refs": [
      "ADR-0015",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "performance",
      "core",
      "metrics",
      "ci"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core.Tests/Performance/PerformanceTrackerTests.cs",
      "logs/perf/<date>/summary.json",
      "logs/ci/<date>/perf/performance-gates-summary.json"
    ],
    "acceptance": [
      "Game.Core/Performance/** 下存在 PerformanceTracker/PerformanceMetrics/QueryPerformanceTracker 等类型，API 与 Phase-15 文档保持一致且不依赖 Godot API。",
      "xUnit 测试覆盖性能库的关键统计逻辑（P50/P95/平均值/最大值），并生成覆盖率报告。",
      "Godot 侧 PerfTracker 使用或适配 Game.Core 性能库的输出，将帧时间/关键路径指标写入 user://logs/perf/perf.json。",
      "新增 scripts/python/performance_gates.py（或等价脚本），读取 PerfTracker JSON 与预算阈值（环境变量），在 logs/perf/<date>/summary.json 与 logs/ci/<date>/perf/** 中生成结果，并通过 exit code 暴露软/硬门禁。"
    ],
    "test_strategy": [
      "单元测试：为性能库编写 xUnit 基准级测试，验证统计函数在不同样本上的正确性。",
      "本地演练：运行 Godot 场景 + PerfTracker，生成 perf.json，再用 performance_gates.py 校验阈值与报告。",
      "CI 集成：在 windows-quality-gate 工作流中增加可选性能门禁 step，观察超阈值时的报告与退出码。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0016",
    "story_id": "PH16-BACKLOG-B1-B3",
    "title": "Observability Autoload 与 Sentry Release Health Gate",
    "description": "按照 Phase-16-Observability-Sentry-Integration.md 与 Backlog，在 Game.Godot 中引入 Observability Autoload（初始化 Sentry Godot SDK、统一日志接口），并实现 Python 版 release_health_gate 脚本：从 Sentry API 读取 Crash-Free Sessions/Users 指标，与 ADR-0003/0015 定义的阈值对齐，在 CI 中生成 release-health.json 并支持作为发布门禁。",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "depends_on": [
      "NG-0015"
    ],
    "adr_refs": [
      "ADR-0003",
      "ADR-0005",
      "ADR-0015",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH03",
      "CH06",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "observability",
      "sentry",
      "release-health",
      "godot"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core.Tests/Observability/ObservabilityClientTests.cs",
      "logs/ci/<date>/release-health.json"
    ],
    "acceptance": [
      "Game.Godot 中新增 Observability Autoload（例如 Observability.cs），在游戏启动早期初始化 Sentry Godot SDK，并设置 Release/Environment。",
      "Game.Core 中存在 ObservabilityClient/StructuredLogger（或等价实现），通过接口注入到核心服务，避免直接依赖 Godot 或 Sentry。",
      "新增 scripts/python/release_health_gate.py，支持配置 SENTRY_* 环境变量与阈值 JSON，生成 logs/ci/<date>/release-health.json 并根据阈值返回 exit code。",
      "CI 中存在可选 release-health 步骤（例如 windows-quality-gate 或独立 workflow），在配置正确的情况下能拉取 Sentry 数据并给出清晰的通过/失败原因。"
    ],
    "test_strategy": [
      "核心测试：为 ObservabilityClient 编写 xUnit 测试，验证日志结构化与 PII 脱敏行为。",
      "脚本测试：使用假数据或 Mock Sentry API 响应运行 release_health_gate.py，验证阈值判定与 JSON 输出格式。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0017",
    "story_id": "PH17-BACKLOG-B1-B2-B3",
    "title": "Python 构建驱动脚本与 Windows Release Workflow 整合",
    "description": "依据 Phase-17-Build-System-and-Godot-Export.md 与 Backlog，在 scripts 下实现跨平台 Python 构建驱动脚本（build_windows.py），统一调用 Godot headless 导出、生成版本元数据（build-info.json/release-profile.json）与 SHA256 校验；并将现有 Windows Release (Tag/Manual) 工作流调整为调用该脚本，简化导出与发布流程。",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "depends_on": [
      "NG-0001",
      "NG-0015"
    ],
    "adr_refs": [
      "ADR-0008",
      "ADR-0011",
      "ADR-0003",
      "ADR-0015"
    ],
    "chapter_refs": [
      "CH03",
      "CH07",
      "CH09",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "build",
      "export",
      "windows",
      "ci",
      "release"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/ci/<date>/export/summary.json",
      "build/build-info.json",
      "build/release-profile.json"
    ],
    "acceptance": [
      "存在 scripts/python/build_windows.py（或等价脚本），在本地 Windows 环境下可通过 Godot headless 导出 Release/Debug EXE，并生成 build-info.json 与 SHA256 校验文件。",
      ".github/workflows/windows-release.yml 与 windows-release-tag.yml 中的导出步骤统一改为调用 build_windows.py，而非直接内联 Godot 导出命令。",
      "Release Notes 或相关文档中引用 build-info.json/release-profile.json，记录版本号、渠道、构建时间与 Commit SHA。",
      "导出的 Game.exe 能在未安装 Godot 的 Windows 环境中直接运行，并通过 smoke_exe.ps1 的冒烟验证。"
    ],
    "test_strategy": [
      "本地构建：在开发机运行 build_windows.py release/debug，验证输出文件与日志。",
      "CI 集成：触发 Windows Release (Manual/Tag) 工作流，确认 Artifact 中包含 EXE、PCK、build-info.json 与 SHA256 校验文件。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0018",
    "story_id": "PH18-19-BACKLOG-CANARY-ROLLBACK",
    "title": "分阶段发布（Canary/Stable）与回滚脚本骨架",
    "description": "基于 Phase-18-Staged-Release-and-Canary-Strategy.md 与 Phase-19-Emergency-Rollback-and-Monitoring.md，为 newguild 提供最小的分阶段发布与回滚脚本骨架：引入 RELEASE_CHANNEL 概念（qa/internal/beta/stable），在构建时生成 release-profile.json，预留 Sentry Release Health 驱动的发布/回滚决策接口。",
    "status": "pending",
    "priority": "P3",
    "layer": "ci",
    "depends_on": [
      "NG-0016",
      "NG-0017"
    ],
    "adr_refs": [
      "ADR-0003",
      "ADR-0005",
      "ADR-0015"
    ],
    "chapter_refs": [
      "CH03",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "release",
      "canary",
      "rollback",
      "sentry"
    ],
    "owner": "architecture",
    "test_refs": [
      "build/release-profile.json",
      "logs/ci/<date>/release-health.json"
    ],
    "acceptance": [
      "构建脚本或 CI 能根据环境变量 RELEASE_CHANNEL（qa/internal/beta/stable）生成包含渠道信息与启用 FeatureFlags 列表的 release-profile.json。",
      "Release 工作流在 Step Summary 或 Artifact 中附带 release-profile.json，便于追踪。",
      "存在回滚脚本或工作流骨架（例如 windows-rollback.yml 或 PowerShell/Python 脚本），至少能根据指定 tag/版本重新触发构建或下载历史 Artifact。",
      "文档中说明 Canary/Stable 渠道的基本策略与 Release Health 驱动的 go/no-go 决策接口（即使实际接入 Sentry 仍在 Backlog）。"
    ],
    "test_strategy": [
      "本地验证：手工设置不同 RELEASE_CHANNEL，运行构建脚本并检查 release-profile.json 差异。",
      "CI 验证：在测试分支上运行带渠道参数的 Release 工作流，确认生成的 profile 与工件符合预期。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0019",
    "story_id": "PH20-22-BACKLOG-DOCS-ACCEPTANCE",
    "title": "项目级功能验收与文档整合骨架",
    "description": "参考 Phase-20-Functional-Acceptance-Testing.md、Phase-21-Performance-Optimization.md 与 Phase-22-Documentation-and-Release-Notes.md，为基于 newguild 的具体游戏项目提供功能验收清单、性能基线与发布说明模板骨架，但不在模板仓库内虚构具体玩法。",
    "status": "pending",
    "priority": "P3",
    "layer": "docs",
    "depends_on": [
      "NG-0001"
    ],
    "adr_refs": [
      "ADR-0005",
      "ADR-0015",
      "ADR-0003"
    ],
    "chapter_refs": [
      "CH03",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "acceptance",
      "docs",
      "perf",
      "release-notes"
    ],
    "owner": "architecture",
    "test_refs": [],
    "acceptance": [
      "在 docs 下增加项目级功能验收/迁移报告/发布说明的模板文件（例如 docs/acceptance/functional_checklist.template.md、docs/release/EXECUTIVE_SUMMARY.template.md），明确字段与引用 ADR/Phase 的方式。",
      "在 README 或 docs/PROJECT_DOCUMENTATION_INDEX.md 中增加一小节，指引项目团队如何基于模板补齐 Phase-20/21/22 所需的项目级文档。",
      "不在模板仓库内引入具体玩法/关卡/敌人等业务细节，保持模板对多个项目的复用性。"
    ],
    "test_strategy": [
      "文档审阅：由架构/产品共同确认模板文档结构对真实项目足够且不过度约束。",
      "链接检查：task-links-validate 或等价脚本对新模板文档进行路径与引用校验。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0020",
    "story_id": "PRD-GUILD-MANAGER-VS-CORE-LOOP",
    "title": "公会管理器首个垂直切片的三层架构与核心类型落地",
    "description": "依据 PRD-Guild-Manager 与 08-功能纵切-公会管理器.md，在 Game.Core / Game.Godot / Tests.Godot 三层落地首个可玩的公会管理垂直切片：实现基础 Guild/GuildMember/Raid/Event 域模型与服务，提供对应的 Godot 场景与 UI Glue，并为该循环建立最小 xUnit 与 GdUnit4 测试集。",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "depends_on": [
      "NG-0001"
    ],
    "adr_refs": [
      "ADR-0018",
      "ADR-0004",
      "ADR-0006",
      "ADR-0007",
      "ADR-0005",
      "ADR-0024"
    ],
    "chapter_refs": [
      "CH01",
      "CH04",
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-Guild-Manager/08/_index.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-功能纵切-公会管理器.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "core",
      "guild",
      "vertical-slice",
      "architecture"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core.Tests/Domain/GuildCoreTests.cs",
      "Game.Core.Tests/Domain/EventEngineTests.cs",
      "Tests.Godot/tests/Scenes/test_guild_main_scene.gd",
      "Tests.Godot/tests/Integration/test_guild_workflow.gd"
    ],
    "acceptance": [
      "Game.Core 中存在 Guild、GuildMember、Raid、Event 等核心域模型与服务，且不依赖 Godot API。",
      "Game.Godot 中存在与 08-功能纵切-公会管理器.md 一致的主场景与公会管理 UI 节点结构，并通过 Adapters 调用 Game.Core 服务。",
      "Tests.Godot 中存在至少一条完整的垂直切片 GdUnit4 用例：启动主场景 → 进入公会管理界面 → 执行一次最小管理操作（如创建公会或查看成员）→ 正常退出。",
      "Game.Core.Tests 中针对 Guild 与事件引擎的 xUnit 测试存在且可运行，覆盖基础行为与错误路径。",
      "上述代码与测试在 Windows CI（ci-windows.yml）中均能通过基本构建与测试步骤。",
      "完成 T2 最小 Guild 领域事件契约集合：core.guild.created、core.guild.member.joined、core.guild.member.left 已分别在 Game.Core/Contracts/Guild/GuildCreated.cs、Game.Core/Contracts/Guild/GuildMemberJoined.cs、Game.Core/Contracts/Guild/GuildMemberLeft.cs 定义，并有至少一个 xUnit 测试类验证 EventType 常量与关键字段。"
    ],
    "test_strategy": [
      "单元测试：扩展 Game.Core.Tests 覆盖 Guild/GuildMember/Raid/Event 等核心类型的构造与业务规则。",
      "场景测试：在 Tests.Godot 中编写主场景与公会管理 UI 的 GdUnit4 用例，验证节点结构与关键 Signals。",
      "集成验证：通过 dev_cli.py run-ci-basic 在本地与 CI 中执行，确认新垂直切片不会破坏现有 CI 流程。"
    ],
    "taskmaster_id": 2,
    "taskmaster_exported": true
  },
  {
    "id": "NG-0021",
    "story_id": "PRD-GUILD-MANAGER-VS-TEST-CI",
    "title": "首个垂直切片的最小 xUnit/GdUnit4/Smoke 流程打通",
    "description": "在 newguild 模板下，为 PRD-Guild-Manager 的首个公会管理垂直切片建立最小可用的测试与 CI 流程：xUnit 覆盖核心域逻辑，GdUnit4 覆盖主场景与基本交互，headless smoke 验证游戏能从命令行启动到主场景并正常退出，所有步骤在 dev_cli.py 与 Windows CI 工作流中可自动执行。",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "depends_on": [
      "NG-0001",
      "NG-0012",
      "NG-0020"
    ],
    "adr_refs": [
      "ADR-0005",
      "ADR-0011",
      "ADR-0018",
      "ADR-0024"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-功能纵切-公会管理器.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "ci",
      "testing",
      "smoke",
      "xunit",
      "gdunit"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core.Tests/Domain/GuildCoreTests.cs",
      "Game.Core.Tests/Domain/GameTurnSystemTests.cs",
      "Tests.Godot/tests/Scenes/test_guild_main_scene.gd",
      "Tests.Godot/tests/Scenes/test_main_scene_smoke.gd",
      "logs/ci/<date>/ci-pipeline-summary.json",
      "logs/e2e/<date>/smoke/selfcheck-summary.json",
      "Game.Core.Tests/Domain/GameLoopTests.cs",
      "Tests.Godot/tests/Scenes/Guild/T2PlayableSceneTests.gd"
    ],
    "acceptance": [
      "dev_cli.py run-ci-basic 在本地 Windows 环境下能成功运行，并至少执行一次 dotnet test 与一次 headless smoke。",
      "Windows CI 工作流（ci-windows.yml 或 windows-quality-gate.yml）中包含对 Game.Core.Tests 与 Tests.Godot 的执行步骤，且在首个垂直切片落地后仍然全部通过。",
      "headless smoke 用例能够在不依赖交互的情况下启动游戏主场景，并输出 [TEMPLATE_SMOKE_READY] 或 [DB] opened 标记。",
      "至少存在一条覆盖 PRD 3.0.3 T2 可玩性场景流的端到端测试路径：Game.Core.Tests/Domain/GameTurnSystemTests.cs（或等价用例）验证三阶段一周循环的状态推进，Tests.Godot/tests/Scenes/test_main_scene_smoke.gd（或等价用例）验证从启动主场景进入首周公会管理界面并完成一次“推进一周”的 UI 流程。",
      "失败的测试或 smoke 能在 logs/ci 与 logs/e2e 目录下生成可用于排查的 JSON/文本日志，与 AGENTS.md 中的日志规范一致。",
      "Game.Core.Tests/Domain/GameLoopTests.cs 与 Tests.Godot/tests/Scenes/Guild/T2PlayableSceneTests.gd 已作为 PRD 3.0.3 T2 可玩性场景流的最小测试入口，分别覆盖 Core 回合状态与场景可玩闭环，并挂接在 NG-0021 与 GM-0103 的 Test-Refs 中。"
    ],
    "test_strategy": [
      "本地：使用 dev_cli.py run-ci-basic 与 run-smoke-strict（如已实现）验证测试和 smoke 流程。",
      "CI：在测试分支上触发 ci-windows 与 windows-quality-gate 工作流，确认所有步骤通过且生成预期的 logs/** 工件。"
    ],
    "taskmaster_id": 6,
    "taskmaster_exported": true
  },
  {
    "id": "NG-0022",
    "story_id": "PRD-GUILD-Manager-DOCS-LINKS",
    "title": "公会管理器文档与回链对齐（PRD/Base/ADR/Overlay/Tasks）",
    "description": "围绕 PRD-Guild-Manager 与 newguild 模板，梳理公会管理器相关文档与任务回链：确保 PRD、Base 文档（CH01–CH07）、相关 ADR、Overlay/08 与 Taskmaster 任务（NG-00xx 与玩法任务）之间存在清晰的一致性链接，避免出现重复口径或断链。",
    "status": "pending",
    "priority": "P2",
    "layer": "docs",
    "depends_on": [
      "NG-0001"
    ],
    "adr_refs": [
      "ADR-0018",
      "ADR-0004",
      "ADR-0005",
      "ADR-0003"
    ],
    "chapter_refs": [
      "CH01",
      "CH03",
      "CH04",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-Guild-Manager/08/_index.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-功能纵切-公会管理器.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "docs",
      "links",
      "acceptance",
      "task-links"
    ],
    "owner": "architecture",
    "test_refs": [
      "docs/prd.txt",
      "docs/architecture/base/01-introduction-and-goals-v2.md",
      "docs/adr/ADR-0018-godot-runtime-and-distribution.md",
      "docs/adr/ADR-0019-godot-security-baseline.md"
    ],
    "acceptance": [
      "docs/prd.txt 中与公会管理器相关的章节在 Overlay/08 中都有对应条目或引用。",
      "与公会管理相关的 ADR（至少 ADR-0018/0019/0004/0005）在 08-功能纵切-公会管理器.md 与本验收清单的 Front-Matter 中有一致引用。",
      "Taskmaster 任务（NG-0001/NG-0020/NG-0021 以及后续玩法任务）在 story_id/adr_refs/chapter_refs/overlay_refs 上与 PRD/Base/ADR/Overlay 建立清晰回链。",
      "task-links-validate（或等价脚本）能够在 CI 中验证上述回链关系并生成报告。"
    ],
    "test_strategy": [
      "文档审阅：由架构/产品共同检查 PRD/Base/ADR/Overlay 是否互相引用、无矛盾口径。",
      "自动化：扩展或实现 task-links-validate 脚本，针对 NG-00xx 与玩法任务校验 story_id/adr_refs/chapter_refs/overlay_refs 与文档实际存在性和一致性。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0023",
    "story_id": "PH9-BACKLOG-B1",
    "title": "事件命名统一迁移（game.* → core.*.*）",
    "description": "根据 Phase-9-Signal-Backlog.md B1，将仍然存在于测试中的旧事件类型（如 game.started/score.changed/player.health.changed）统一迁移为 core.*.* 命名约定，并更新相关测试与文档，避免旧前缀继续被误用。",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "depends_on": [
      "NG-0001"
    ],
    "adr_refs": [
      "ADR-0004",
      "ADR-0006",
      "ADR-0018",
      "ADR-0023"
    ],
    "chapter_refs": [
      "CH01",
      "CH04",
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-Contracts-Guild-Manager-Events.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/08-功能纵切-公会管理器.md",
      "docs/architecture/overlays/PRD-Guild-Manager/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "signal",
      "events",
      "naming",
      "core"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Tests.Godot/tests/Scenes/test_main_scene_signals.gd"
    ],
    "acceptance": [
      "Game.Core 与 Tests 中不再存在 game.started/score.changed/player.health.changed 等旧事件类型，全部迁移为 core.*.* 命名。",
      "GameEngineCoreEventTests 覆盖新的事件类型常量，并全部通过。",
      "Overlay 08-Contracts-Guild-Manager-Events.md 与 08-功能纵切-公会管理器.md 中的事件示例与实际事件类型保持一致。",
      "一次 signal 自检（例如全文搜索）可以证明仓库内仅保留 core.*.* 作为事件命名前缀。"
    ],
    "test_strategy": [
      "本地：运行 GameEngineCoreEventTests，并通过全文搜索核对事件类型常量。",
      "CI：在质量门禁中增加针对 core.*.* 事件类型前缀的简单字符串检查脚本。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0024",
    "story_id": "PH16-BACKLOG-B2",
    "title": "Game.Core Observability 客户端与结构化日志",
    "description": "根据 Phase-16-Observability-Backlog.md B2，在 Game.Core 层实现可复用的 ObservabilityClient/StructuredLogger/PiiDataScrubber，使核心逻辑能够在不直接依赖 Godot 或 Sentry SDK 的前提下输出结构化日志并上报事件。",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "depends_on": [
      "NG-0016"
    ],
    "adr_refs": [
      "ADR-0003",
      "ADR-0005",
      "ADR-0015",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH03",
      "CH06",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "observability",
      "logging",
      "core",
      "sentry"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core/Observability/ObservabilityClient.cs",
      "Game.Core.Tests/Observability/ObservabilityClientTests.cs"
    ],
    "acceptance": [
      "Game.Core/Observability 下存在 ObservabilityClient/StructuredLogger/PiiDataScrubber 等类型，且不引用任何 Godot API。",
      "核心服务通过依赖注入使用 ILogger/ObservabilityClient 接口，而不是直接依赖 Sentry 或具体实现。",
      "ObservabilityClient 能够生成包含 logger、level、tags、extra、breadcrumbs 的结构化日志对象，并在单元测试中可被验证。",
      "至少一组 xUnit 测试验证 PII 字段在过滤逻辑中被正确脱敏或丢弃。"
    ],
    "test_strategy": [
      "本地：为 ObservabilityClient 编写 xUnit 测试，使用 fake/spy 对象捕获日志与事件上报行为。",
      "CI：在 dotnet-unit 任务中确保 Observability 测试纳入覆盖率统计，并在质量门禁报告中展示相关用例。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0025",
    "story_id": "PH16-BACKLOG-B4",
    "title": "隐私与合规文档（privacy-compliance.md）",
    "description": "根据 Phase-16-Observability-Backlog.md B4，在 docs 目录下新增privacy-compliance.md，明确日志、审计、Sentry 事件中允许出现的字段、PII 分类与脱敏策略，以及数据保留与删除（Retention）约束。",
    "status": "pending",
    "priority": "P2",
    "layer": "docs",
    "depends_on": [
      "NG-0016"
    ],
    "adr_refs": [
      "ADR-0003",
      "ADR-0019",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH02",
      "CH03",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "docs",
      "privacy",
      "compliance",
      "observability",
      "security"
    ],
    "owner": "architecture",
    "test_refs": [
      "docs/privacy-compliance.md",
      "logs/ci/<date>/task-links.json"
    ],
    "acceptance": [
      "docs/privacy-compliance.md 存在，并链接自 AGENTS.md 或 testing-framework.md 中的隐私与日志相关章节。",
      "文档中枚举至少一份字段级别的 PII 分类清单，并描述日志、Sentry 事件中的脱敏策略与禁止上报的字段类型。",
      "文档引用 ADR-0003 与 ADR-0019，说明与 Release Health、Godot 安全基线之间的关系。",
      "task-links-validate 或等价脚本能够校验 tasks_back.json 中引用privacy-compliance.md 的任务与文档之间的回链关系。"
    ],
    "test_strategy": [
      "文档审阅：由架构或安全角色人工检查 privacy-compliance.md 是否覆盖日志、Sentry 与审计 JSONL 的隐私约束。",
      "自动化：在 task-links-validate 中增加针对 privacy-compliance.md 的引用检查，保证后续任务不会绕过该文档。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0026",
    "story_id": "PH16-BACKLOG-B5",
    "title": "可观测性与日志使用规范（logging-guidelines.md）",
    "description": "根据 Phase-16-Observability-Backlog.md B5，在 docs 下新增 logging-guidelines.md，对 logger 命名空间、级别使用方式、日志路径结构（logs/ci、logs/e2e、user://logs）以及与 ADR-0003 的结构化日志模型进行统一约定。",
    "status": "pending",
    "priority": "P2",
    "layer": "docs",
    "depends_on": [
      "NG-0024"
    ],
    "adr_refs": [
      "ADR-0003",
      "ADR-0005",
      "ADR-0018",
      "ADR-0023"
    ],
    "chapter_refs": [
      "CH01",
      "CH03",
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "docs",
      "logging",
      "observability",
      "guidelines"
    ],
    "owner": "architecture",
    "test_refs": [
      "docs/logging-guidelines.md",
      "AGENTS.md"
    ],
    "acceptance": [
      "docs/logging-guidelines.md 存在，并在 AGENTS.md 中被引用为日志使用的唯一规范来源。",
      "文档对 logger 命名空间（如 game.core、ui.menu、db.access、security）、日志级别（debug/info/warning/error）以及 breadcrumbs 使用方式给出清晰建议。",
      "文档中的日志路径结构与 6.3 节（logs/** SSoT）保持一致，未引入新的散乱目录。",
      "后续新增的日志相关任务在 adr_refs 和 acceptance 中明确遵守 logging-guidelines.md。"
    ],
    "test_strategy": [
      "文档审阅：在评审 PR 时检查日志相关变更是否引用 logging-guidelines.md 并符合其约定。",
      "自动化：在 task-links-validate 或等价脚本中校验日志相关任务是否引用该文档。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0027",
    "story_id": "PH13-BACKLOG-B3",
    "title": "代码重复率与圈复杂度门禁",
    "description": "根据 Phase-13-Quality-Gates-Backlog.md B3，为 newguild 模板补齐代码重复率（Duplication%）与圈复杂度（Cyclomatic Complexity）质量门禁，将 jscpd、Roslyn 或 SonarQube 指标纳入 quality_gates.py 的统一判断。",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "depends_on": [
      "NG-0013"
    ],
    "adr_refs": [
      "ADR-0005",
      "ADR-0018",
      "ADR-0024"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "ci",
      "quality-gates",
      "duplication",
      "complexity"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/ci/<date>/quality-gates-duplication.json",
      "logs/ci/<date>/quality-gates-complexity.json"
    ],
    "acceptance": [
      "存在脚本或配置能够生成重复率与圈复杂度的机器可读报告，并写入logs/ci/<date>/quality-gates-duplication.json 与 quality-gates-complexity.json。",
      "quality_gates.py 能够读取上述报告，根据 Phase-13 设定的阈值（例如 Dup% ≤ 2%，最大圈复杂度 ≤ 10，平均圈复杂度 ≤ 5）给出 PASS/FAIL。",
      "在 CI 中至少有一条 Job 使用 quality_gates.py 作为门禁，并在失败时提供清晰的重复率与复杂度摘要。"
    ],
    "test_strategy": [
      "本地：构造一个故意高重复率、高复杂度的小示例，验证 quality_gates.py 能将其标记为 failed。",
      "CI：在 windows-quality-gate 工作流中增加对 duplication 与 complexity 报告的校验，并在 Step Summary 中展示关键指标。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0028",
    "story_id": "PH13-BACKLOG-B4",
    "title": "性能 P95 与审计 JSONL 校验",
    "description": "根据 Phase-13-Quality-Gates-Backlog.md B4，将性能 P95 阈值与 security-audit.jsonl 的结构校验纳入 quality_gates.py，实现对 logs/perf/summary.json 与logs/ci/<date>/security-audit.jsonl 的自动化检查。",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "depends_on": [
      "NG-0013",
      "NG-0014",
      "NG-0015"
    ],
    "adr_refs": [
      "ADR-0015",
      "ADR-0005",
      "ADR-0019",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH02",
      "CH06",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "ci",
      "performance",
      "audit",
      "quality-gates"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/perf/<date>/summary.json",
      "logs/ci/<date>/security-audit.jsonl",
      "logs/ci/<date>/quality-gates-perf.json"
    ],
    "acceptance": [
      "新增 scripts/python/validate_perf.py 与 scripts/python/validate_audit_logs.py，能够检查 P95 是否在预算内，以及 security-audit.jsonl 每行为合法 JSON 且包含必需字段。",
      "quality_gates.py 支持在 all 模式下调用上述校验脚本，并在失败时返回非零退出码。",
      "CI 日志中可以看到 P95 与审计 JSONL 校验的摘要输出，并产生对应 JSON 摘要文件。"
    ],
    "test_strategy": [
      "单元：为 validate_perf 与 validate_audit_logs 编写测试，验证边界条件与错误路径。",
      "集成：在 CI 中对刻意构造的超阈值样例运行 quality_gates.py，验证能够正确失败并输出预期的 JSON 摘要。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0029",
    "story_id": "PH14-BACKLOG-B5",
    "title": "Signal 健康度验证与安全相关测试门禁",
    "description": "根据 Phase-14-Godot-Security-Backlog.md B5，在安全相关 Signal 上补齐 XML 注释与规范化命名，并通过 xUnit、GdUnit4 或专用脚本，将这些检查纳入 CI 中的信号健康度门禁。",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "depends_on": [
      "NG-0014",
      "NG-0023"
    ],
    "adr_refs": [
      "ADR-0019",
      "ADR-0004",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH02",
      "CH04",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "security",
      "signal",
      "gdunit",
      "adapter",
      "testing"
    ],
    "owner": "architecture",
    "test_refs": [
      "Tests.Godot/tests/Security/Hard/test_security_signals_health.gd",
      "logs/ci/<date>/signal-health-summary.json"
    ],
    "acceptance": [
      "与安全相关的关键 Signal（例如 SecurityHttpClient.RequestBlocked 等）具备完整的XML 注释与稳定的命名约定。",
      "存在至少一组 GdUnit4 测试或分析脚本，对这些 Signal 的注册与触发进行验证，并在失败时产生可读的 JSON 摘要。",
      "CI 中新增或扩展一个步骤，用于执行 Signal 健康度检查，并在日志中给出通过与失败的统计。"
    ],
    "test_strategy": [
      "GdUnit4：为安全相关 Signal 编写 Hard 套件，用于验证触发路径与 XML 注释是否齐全。",
      "CI：在 signal-compliance 相关工作流中集成健康度检查脚本，并观察在故意缺失注释或错误命名时是否会失败。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0030",
    "story_id": "PH15-BACKLOG-B3",
    "title": "性能报告与历史追踪（reports/performance/**）",
    "description": "根据 Phase-15-Performance-Budgets-Backlog.md B3，为性能测试结果生成 HTML 或 JSON 报告与历史记录（如 performance-history.csv），支持人工分析与长期趋势跟踪。",
    "status": "pending",
    "priority": "P3",
    "layer": "ci",
    "depends_on": [
      "NG-0015",
      "NG-0028"
    ],
    "adr_refs": [
      "ADR-0015",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "performance",
      "reports",
      "ci",
      "observability"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/perf/<date>/summary.json",
      "reports/performance/current-run-report.json",
      "reports/performance/performance-history.csv"
    ],
    "acceptance": [
      "存在脚本可以从 logs/perf/<date>/summary.json 等原始数据生成当前运行报告与历史记录文件，写入 reports/performance 目录。",
      "CI 将 reports/performance 目录中的文件作为 artifact 上传，便于离线分析。",
      "至少有一个简单的趋势图或统计汇总（可以是 JSON 或 CSV），帮助判断性能回归。"
    ],
    "test_strategy": [
      "本地：构造多次性能采样结果，运行报告生成脚本，检查历史文件是否按预期累积数据。",
      "CI：在性能相关 Job 中执行报告生成步骤，并检查 artifact 中是否包含预期文件。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0031",
    "story_id": "PH15-BACKLOG-B5",
    "title": "独立性能门禁 CI 工作流（performance-gates.yml）",
    "description": "根据 Phase-15-Performance-Budgets-Backlog.md B5，新增专门的性能门禁 CI 工作流（例如 .github/workflows/performance-gates.yml），仅运行性能相关脚本与阈值校验，与常规 build/test 工作流解耦。",
    "status": "pending",
    "priority": "P3",
    "layer": "ci",
    "depends_on": [
      "NG-0015",
      "NG-0028",
      "NG-0030"
    ],
    "adr_refs": [
      "ADR-0015",
      "ADR-0005",
      "ADR-0011",
      "ADR-0008",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07",
      "CH09",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "ci",
      "performance",
      "workflow",
      "quality-gates"
    ],
    "owner": "architecture",
    "test_refs": [
      ".github/workflows/performance-gates.yml",
      "logs/ci/<date>/performance-gates-summary.json"
    ],
    "acceptance": [
      "仓库中存在独立的性能门禁工作流文件 performance-gates.yml，并在文档中说明触发条件与使用场景。",
      "性能工作流只运行性能采集与阈值校验相关脚本，不重复常规 build/test 步骤。",
      "performance-gates 工作流在阈值未通过时能明确标记失败原因，并输出 JSON 摘要到 logs/ci/<date>/performance-gates-summary.json。"
    ],
    "test_strategy": [
      "CI：针对测试分支手动触发 performance-gates 工作流，观察在性能超阈值和正常情况下的行为差异。",
      "文档：在 Phase-15 或 README 中记录如何启用或关闭性能门禁工作流。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0032",
    "story_id": "PH17-BACKLOG-B4",
    "title": "代码签名与安全分发",
    "description": "根据 Phase-17-Build-Backlog.md B4，在构建链路中引入可配置的代码签名步骤，使用 Windows SignTool 对 Game.exe（及安装包如存在）进行签名，并在构建与发布日志中记录签名状态。",
    "status": "pending",
    "priority": "P3",
    "layer": "ci",
    "depends_on": [
      "NG-0017"
    ],
    "adr_refs": [
      "ADR-0008",
      "ADR-0011",
      "ADR-0019",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH02",
      "CH06",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "build",
      "signing",
      "security",
      "release",
      "windows"
    ],
    "owner": "architecture",
    "test_refs": [
      "scripts/python/build_windows.py",
      "logs/ci/<date>/signing-summary.json",
      "build/Game.exe"
    ],
    "acceptance": [
      "build_windows.py 或等价构建脚本支持可选的代码签名步骤，通过环境变量配置证书路径和密码。",
      "当签名启用且证书有效时，生成的 Game.exe 已被 SignTool 签名，且 signing-summary.json 中记录成功状态；在未配置证书时构建仍可完成但不会尝试签名。",
      "README 或 Phase-17 文档中说明如何在本地与 CI 环境中开启代码签名以及注意事项。"
    ],
    "test_strategy": [
      "本地：在具备测试证书的环境下执行构建，验证 EXE 已被签名且系统属性中可见。",
      "CI：在 Windows 构建 Job 中对 signing-summary.json 做基础格式检查，确保脚本在有与无证书两种场景下都能稳定运行。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0033",
    "story_id": "PH17-BACKLOG-B5",
    "title": "导出预设与多配置支持",
    "description": "根据 Phase-17-Build-Backlog.md B5，在 Godot export_presets.cfg 中配置多个导出预设（Debug、Release、Demo 等），并在构建脚本中增加相应的导出参数支持。",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "depends_on": [
      "NG-0017"
    ],
    "adr_refs": [
      "ADR-0011",
      "ADR-0018",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "godot",
      "export",
      "presets",
      "windows",
      "release"
    ],
    "owner": "architecture",
    "test_refs": [
      "export_presets.cfg",
      "logs/ci/<date>/export/summary.json"
    ],
    "acceptance": [
      "export_presets.cfg 中至少定义 Debug 与 Release 两类 Windows Desktop 导出预设，并按需扩展 Demo 等配置。",
      "构建脚本可以根据参数选择不同的导出预设，生成对应的 EXE 与 PCK。",
      "CI 中至少有一条导出 Job 使用 Release 预设，并在导出 summary 中注明所用配置。"
    ],
    "test_strategy": [
      "本地：在 Godot 编辑器与 headless 模式下分别验证各导出预设可以成功生成可运行的 EXE。",
      "CI：在 export 相关工作流中记录所用预设名称，并检查导出 summary 中的配置字段。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0034",
    "story_id": "ADR-0005-STRUCTURAL-REFACTOR-GUIDELINE",
    "title": "结构性重构与行级禁用回收",
    "description": "根据 ADR-0005 新增的“结构性重构优先于行级禁用”口径，在现有 newguild 仓库中系统梳理所有基于 lint/静态分析/复杂度规则的行级禁用（包括 ESLint、TypeScript、.NET/Roslyn 分析器、StyleCop 等），为每一类禁用落盘对应的重构任务（NG/GM），并在重构完成后移除禁用、恢复质量门禁。",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "depends_on": [],
    "adr_refs": [
      "ADR-0005",
      "ADR-0018",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "refactor",
      "quality-gates",
      "analyzers",
      "godot",
      "csharp"
    ],
    "owner": "architecture",
    "test_refs": [
      "scripts/python/task_links_validate.py",
      "logs/ci/<date>/quality-gates-structural-refactor.json"
    ],
    "acceptance": [
      "使用专用脚本或现有工具扫描仓库中所有行级禁用（如 // eslint-disable、#pragma warning disable 等），生成禁用基线清单，并按模块分类输出到 logs/ci/<date>/quality-gates-structural-refactor.json。",
      "为每类禁用创建或补充对应的 NG/GM 重构任务，任务中显式引用 ADR-0005，并在 acceptance 中写明“移除禁用标记、规则重新生效且门禁保持绿灯”。",
      "在至少一轮 CI 运行中验证：经过结构性重构处理的模块不再依赖行级禁用，同类质量规则依然开启且通过（Dotnet 分析器/ESLint/GdUnit4/coverage 门禁均为绿）。"
    ],
    "test_strategy": [
      "脚本校验：为禁用扫描脚本编写最小单元测试或集成测试，验证对典型文件（TS/CS/配置文件）能正确识别和统计行级禁用标记。",
      "基线比较：在两次 CI 运行之间比较禁用基线 JSON，确认整体禁用数量单调下降或保持不变，避免在无计划的情况下新增长期禁用。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0035",
    "story_id": "NG-0034-CODE-ANALYZER-CLEANUP-CSHARP",
    "title": "将 GdUnit4 C# API pragma 明确归类为第三方特例",
    "description": "基于 NG-0034 的禁用基线报告，对 Tests.Godot/addons/gdUnit4/src/dotnet/GdUnit4CSharpApi.cs 中的 #pragma warning disable 条目进行专项评估：确认其为上游 GdUnit4 官方插件为兼容 Godot/分析器而设置的特例，在 newguild 仓库中不对其进行源码级重构，而是通过 .editorconfig 降级相应规则，仅将结构性重构原则应用于项目自有代码（Game.Core/Game.Godot 等）。",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "depends_on": [
      "NG-0034"
    ],
    "adr_refs": [
      "ADR-0005",
      "ADR-0024",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "refactor",
      "analyzers",
      "gdunit4",
      "csharp"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/ci/<date>/quality-gates-structural-refactor.json",
      "Tests.Godot/addons/gdUnit4/src/dotnet/GdUnit4CSharpApi.cs"
    ],
    "acceptance": [
      "在禁用基线 JSON 中为 Tests.Godot/addons/gdUnit4/src/dotnet/GdUnit4CSharpApi.cs 相关条目明确标记为“第三方插件特例”，并在任务备注或附加文档中说明来源（GdUnit4 官方仓库）与保留理由。",
      "在 .editorconfig 中为 Tests.Godot/addons/gdUnit4/**/*.cs 配置独立的分析器严重级别（例如将 IDE1006/IDE0028/CA1711/CA2213 设为 silent，将 CA1031 降级为 suggestion），确保这部分代码不会阻塞项目自有代码的质量门禁。",
      "重新运行 scan_code_disables 脚本后，确认禁用基线中仍然包含这些 GdUnit4 pragma 条目，但在后续 NG/GM 重构任务规划中不再将其视为需要通过结构性重构消解的技术债，而是通过配置层面隔离出项目代码与第三方插件代码的质量责任边界。"
    ],
    "test_strategy": [
      "手动与 xUnit/GdUnit4 回归：在尝试移除或调整 pragma 前后运行 Tests.Godot 相关套件，确保测试仍然稳定。",
      "基线比较：对比两次 quality-gates-structural-refactor.json，确认 GdUnit4CSharpApi.cs 相关禁用的变化符合预期，并记录在任务备注中。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0036",
    "story_id": "NG-0034-CODE-ANALYZER-CLEANUP-DOCUMENTATION",
    "title": "调整 ADR 与 Taskmaster 文本中的禁用示例，避免被扫描计入噪音",
    "description": "当前禁用基线报告中包含 .taskmaster/tasks/tasks_back.json、docs/adr/ADR-0005-quality-gates.md 与 scripts/python/scan_code_disables.py 自身的模式示例（如 // eslint-disable 和 #pragma warning disable）。本任务旨在通过轻量文本调整（例如使用占位符 <ESLINT_DISABLE> 或代码块转义）降低这些示例对禁用基线的干扰，同时保持文档与任务说明的可读性与完整性。",
    "status": "pending",
    "priority": "P3",
    "layer": "docs",
    "depends_on": [
      "NG-0034"
    ],
    "adr_refs": [
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "docs",
      "refactor",
      "quality-gates"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/ci/<date>/quality-gates-structural-refactor.json",
      ".taskmaster/tasks/tasks_back.json",
      "docs/adr/ADR-0005-quality-gates.md",
      "scripts/python/scan_code_disables.py"
    ],
    "acceptance": [
      "通过调整示例文本（如使用占位符或说明性文字）减少或消除 .taskmaster/tasks/tasks_back.json 与 ADR-0005 中因示例而被扫描出来的 eslint_disable 条目，同时保证文档对开发者仍然清晰易懂。",
      "更新 scan_code_disables.py 中的模式定义说明，使其明确区分“真正的行级禁用代码”和“文档中的示例/说明”，必要时对脚本逻辑做排除处理（例如忽略 docs/ 或 .taskmaster/）。",
      "重新运行 scan_code_disables 脚本，验证禁用基线 JSON 中的示例性条目数量显著减少，真实代码中的禁用统计保持不变。"
    ],
    "test_strategy": [
      "文档审阅：由架构/维护者确认调整后的示例仍然传达相同含义，且不会误导协作者。",
      "脚本回归：在调整脚本过滤规则后运行 scan_code_disables.py，确保不会因为新增过滤逻辑而漏报真实代码中的禁用。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0037",
    "story_id": "PH16-BACKLOG-TASKMASTER-SENTRY-FEEDBACK",
    "title": "基于 Sentry/错误反馈的 Taskmaster 草案生成骨架",
    "description": "在完成 Observability Autoload 与 release_health_gate 最小骨架之后，为 newguild 设计一条从 Sentry/错误反馈到 Taskmaster 任务草案的自动回链通道：通过夜间或手动触发的 Python 脚本读取近 24 小时内的新/回归错误 TopN（按环境与标签过滤），生成 .taskmaster/tasks/tasks_sentry_draft.json 或等价草案文件，并在 CI 中以非阻断方式产生日志与工件，供架构/owner 人工审阅后再选择性合并为正式 NG/GM 任务。",
    "status": "pending",
    "priority": "P3",
    "layer": "ci",
    "depends_on": [
      "NG-0016",
      "NG-0018",
      "NG-0022"
    ],
    "adr_refs": [
      "ADR-0003",
      "ADR-0005",
      "ADR-0015"
    ],
    "chapter_refs": [
      "CH03",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "taskmaster",
      "sentry",
      "ci",
      "observability"
    ],
    "owner": "architecture",
    "test_refs": [
      "scripts/python/task_links_validate.py",
      "logs/ci/<date>/taskmaster/auto_sentry_tasks.json",
      "logs/ci/<date>/taskmaster/auto_sentry_tasks-summary.json"
    ],
    "acceptance": [
      "存在 Python 脚本或等价实现，能够在不直接修改 tasks_back.json/tasks_gameplay.json 的前提下，从 Sentry API（或占位假数据）中读取近 24 小时内的新/回归错误 TopN，并生成 .taskmaster/tasks/tasks_sentry_draft.json 或等价草案文件，至少包含 Sentry 链接、错误摘要、初步模块标签。",
      "CI 中增加一条非阻断 Job（例如 nightly 或可手动触发），调用上述脚本并将生成的草案与日志收敛到 logs/ci/<date>/taskmaster/**，通过 docs-encoding-and-ai-index-logs 或独立工件提供下载，而不直接阻断构建。",
      "Taskmaster/回链治理文档中明确说明：来自 Sentry 的自动草案必须经过架构/owner 人工审阅与筛选后，才可被提升为正式 NG/GM 任务，并在提升过程中补齐 story_id/adr_refs/chapter_refs/overlay_refs 与 test_refs，避免将噪音或未脱敏字段直接写入正式任务文件。"
    ],
    "test_strategy": [
      "脚本级测试：对占位的 Sentry 响应样本运行草案生成脚本，验证能够正确过滤环境与时间窗口、生成 TopN 草案条目，并写入预期 JSON 文件路径。",
      "流程级验证：在测试环境中手动触发 nightly Job，检查生成的 logs/ci/<date>/taskmaster/** 工件是否包含预期的草案与摘要，并在 task_links_validate 或等价脚本中确认草案文件不会被误解为正式回链来源。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0038",
    "story_id": "PH07-BACKLOG-ARCH-DEPENDENCY-GUARD",
    "title": "架构依赖护栏与依赖图校验骨架",
    "description": "根据 Base 07 章 7.y “架构依赖护栏（Godot + C# 模板）” 与 ADR-0007（端口与适配器），为 newguild 提供一套最小可执行的依赖矩阵与校验骨架：在 C# 工程层面约束 Game.Core/Game.Godot/Tests.* 之间的引用方向，在 Godot Scripts 目录层面约束 Scripts/Core/Adapters/Scenes 的依赖关系，并通过 CI 中的依赖护栏脚本生成 logs/ci/<date>/dependency-guard.json 与摘要，逐步收紧 Core 禁 Godot/测试、Adapters 不反向依赖 UI 的架构约束。",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "depends_on": [
      "NG-0001",
      "NG-0013",
      "NG-0020"
    ],
    "adr_refs": [
      "ADR-0007",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "ci",
      "architecture",
      "dependency-guard",
      "godot",
      "csharp"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/ci/<date>/dependency-guard.json",
      "logs/ci/<date>/dependency-guard-summary.txt"
    ],
    "acceptance": [
      "docs/architecture/base/07-dev-build-and-gates-v2.md 中 7.y 小节明确给出项目级与目录级依赖矩阵（Game.Core/Game.Godot/Tests.* 与 Scripts/Core/Adapters/Scenes 的允许/禁止依赖关系），AGENTS.md 中引用该小节作为架构依赖 SSoT。",
      "存在 scripts/python/dependency_guard.py 或等价脚本，能够扫描 C# 工程（csproj 与 using 语句）和 Godot Scripts 目录结构，检测是否存在违反依赖矩阵的引用（例如 Game.Core 中出现 Godot 命名空间、Game.Godot 引用 Tests.*、Scripts/Core 引用 Godot API 等），并将结果写入 logs/ci/<date>/dependency-guard.json 与文本摘要。",
      "在 windows-quality-gate 或等价 CI 工作流中增加依赖护栏脚本的调用步骤（初期可为软门禁），当检测到违规依赖时在 Step Summary 中给出清晰的违规列表，后续可按需要将部分规则提升为硬门禁。"
    ],
    "test_strategy": [
      "本地：构造刻意违反依赖矩阵的示例（例如在 Game.Core 中添加 using Godot; 或在 Scripts/Core 中直接引用 Godot API），运行 dependency_guard 脚本验证其能正确发现并在 JSON/文本摘要中报告。",
      "CI：在测试分支上启用依赖护栏步骤，故意保留一处违规依赖，确认 windows-quality-gate（或等价工作流）中的 Step Summary 能显示违规详情，并在规则配置为硬门禁时正确使 Job 失败。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0039",
    "story_id": "PH16-GAMELOOP-SECURITY-BASELINE",
    "title": "GameLoop 安全审计基线与任务映射收口",
    "description": "根据最新的 GameLoop 安全审计报告（logs/security-audit-gameloop.*）和 cifix.txt，对照 ADR-0019/0004/0005/0018 重新梳理 F001–F007，区分 T2 阶段必须完成与 NG 安全 backlog 的工作，并在 tasks_back.json / tasks_gameplay.json 中补齐 adr_refs/chapter_refs/overlay_refs/test_refs，使后续审计与 task_links_validate 以统一口径运行。",
    "status": "pending",
    "priority": "P1",
    "layer": "docs",
    "depends_on": [
      "NG-0001"
    ],
    "adr_refs": [
      "ADR-0019",
      "ADR-0004",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH02",
      "CH04",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "security",
      "gameloop",
      "docs",
      "audit"
    ],
    "owner": "architecture",
    "test_refs": [
      "logs/security-audit-gameloop.json",
      "logs/SECURITY_AUDIT_GAMELOOP_REPORT.md",
      "cifix.txt"
    ],
    "acceptance": [
      "SECURITY_AUDIT_GAMELOOP_REPORT.md 以 ADR-0019 为基线，明确区分 T2_BLOCKING 与 NG_BACKLOG 安全问题，并与 cifix.txt 中的技术债记录一致。",
      "F001/F002/F005 至少映射到一条 T2 相关 NG/GM 任务，F003/F004/F006/F007 映射到 NG 安全或架构 backlog 任务，且在 tasks_back.json / tasks_gameplay.json 中补齐 adr_refs/chapter_refs/overlay_refs/test_refs。",
      "运行 py -3 scripts/python/task_links_validate.py 时，GameLoop 相关任务不再因为 ADR/Chapter 映射或缺失 Test-Refs 报错。"
    ],
    "test_strategy": [
      "人工对比 logs/security-audit-gameloop.* 与 tasks_back.json / tasks_gameplay.json，确认每条 F00x 至少有一条对应任务可追踪。",
      "运行 task_links_validate.py 与 check_tasks_all_refs.py，确认新增/调整后的 NG/GM 任务全部通过回链校验。"
    ],
    "taskmaster_exported": true,
    "taskmaster_id": 9,
    "contract_refs": [
      "core.game_turn.started",
      "core.game_turn.phase_changed",
      "core.game_turn.week_advanced",
      "security.file_access.denied",
      "security.process.denied",
      "security.url_access.denied"
    ]
  },
  {
    "id": "NG-0040",
    "story_id": "PH16-GAMELOOP-SAVEID-VALUE",
    "title": "GameLoop SaveIdValue 值对象与白名单校验",
    "description": "在 Game.Core 中为 GameLoop 引入 SaveIdValue 值对象（或等价验证器），实现基于 ADR-0019 的白名单规则（仅允许 [a-zA-Z0-9_-] 且长度 1-64），并在 GameTurnState/GameTurnSystem 与 GameLoop 相关合约中统一使用该类型；同时新增 SaveId 安全向单元测试，覆盖非法输入与边界值。",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "depends_on": [
      "NG-0039"
    ],
    "adr_refs": [
      "ADR-0019",
      "ADR-0004",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH02",
      "CH04",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "security",
      "gameloop",
      "core",
      "t2"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core/Domain/Turn/SaveIdValue.cs",
      "Game.Core.Tests/Domain/SaveIdValueTests.cs",
      "Game.Core.Tests/Domain/GameTurnSystemTests.cs",
      "Game.Core.Tests/Domain/GameLoopTests.cs"
    ],
    "acceptance": [
      "Game.Core/Domain/Turn 下新增 SaveIdValue（或等价类型），实现 [a-zA-Z0-9_-]{1,64} 的白名单校验，非法输入抛出 ArgumentException。",
      "GameTurnState / GameTurnSystem 在内部使用 SaveIdValue 作为 SaveId 的入口类型，确保后续事件与存储只接受经过校验的值。",
      "Game.Core.Tests 中新增 SaveIdValueTests 与针对无效 SaveId 的 GameTurnSystem / GameLoop 测试，覆盖空字符串、超长、SQL 片段、路径遍历等典型攻击向量。",
      "dotnet test Game.Core.Tests 在本地与 CI 均可通过，且与 PRD 3.0.3 T2 可玩性场景流描述一致。"
    ],
    "test_strategy": [
      "单元测试：在 SaveIdValueTests 中穷举典型非法/合法输入，验证构造/工厂方法的行为与异常信息。",
      "集成测试：在 GameTurnSystemTests 与 GameLoopTests 中增加使用非法 SaveId 的路径，验证系统拒绝不符合白名单的存档槽 ID。"
    ],
    "taskmaster_exported": true,
    "taskmaster_id": 10,
    "contract_refs": [
      "core.game_turn.started",
      "core.game_turn.phase_changed",
      "core.game_turn.week_advanced"
    ]
  },
  {
    "id": "NG-0041",
    "story_id": "PH07-GAMELOOP-ARCH-REFINE",
    "title": "GameLoop 架构骨架收敛：Ports/时间/状态整理",
    "description": "根据 cifix.txt 的建议，围绕 GameLoop 相关代码完成一轮轻量级架构收敛：将 IAICoordinator/IEventEngine/IGameTurnSystem/IEventBus 等接口统一归档到 Ports 命名空间；移除当前未使用的 ITime/IAICoordinator 依赖或明确使用场景；将 _firstTurnStarted 等可变实例状态迁移到 GameTurnState 等不可变记录类型中；并统一使用 DateTimeOffset 表达时间语义。",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "depends_on": [
      "NG-0020"
    ],
    "adr_refs": [
      "ADR-0007",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "architecture",
      "gameloop",
      "ports",
      "refactor"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Core/Engine/GameTurnSystem.cs",
      "Game.Core/Domain/Turn/GameTurnState.cs",
      "Game.Core/Contracts/DomainEvent.cs",
      "Game.Core.Tests/Domain/GameTurnSystemTests.cs"
    ],
    "acceptance": [
      "所有 GameLoop 相关接口（IGameTurnSystem/IEventEngine/IAICoordinator/IEventBus 及相关仓储接口）统一落盘在 Game.Core.Ports 命名空间或其子命名空间中。",
      "GameTurnSystem 中不再保留完全未使用的 ITime/IAICoordinator 依赖字段，或在测试中有明确用途并通过测试用例覆盖。",
      "与首回合相关的状态（如是否已发布 GameTurnStarted）通过 GameTurnState 等不可变 record 表达，而不是隐藏在可变实例字段中。",
      "DomainEvent 等核心事件类型统一使用 DateTimeOffset 表示时间，避免新的 DateTime 混用进入 GameLoop 关键路径。"
    ],
    "test_strategy": [
      "结构检查：通过现有 dependency_guard.py（或临时脚本）扫描接口文件位置与命名空间，确认 Ports/Domain/Engine 层次符合 ADR-0007。",
      "回归测试：运行 Game.Core.Tests 全量，确保架构调整后所有 GameLoop 相关测试依旧通过。"
    ],
    "taskmaster_exported": false
  },
  {
    "id": "NG-0042",
    "story_id": "PH06-GAMELOOP-SQLITE-PATH-HARDENING",
    "title": "SqliteDataStore 路径校验与插件后端安全收紧",
    "description": "在 Game.Godot/Adapters/SqliteDataStore 中增强路径与扩展名校验：对 user:// 路径进行规范化后再做前缀与 .. 检查，增加 .db/.sqlite/.sqlite3 等扩展名白名单，并为已有 ValidatePath 逻辑补充文件大小上限检查；同时通过环境变量限制 plugin backend 的启用范围（如仅在开发环境允许），将 plugin backend 风险收敛为受控技术债。",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "depends_on": [
      "NG-0014"
    ],
    "adr_refs": [
      "ADR-0019",
      "ADR-0006",
      "ADR-0005",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH02",
      "CH05",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "security",
      "sqlite",
      "godot",
      "adapter"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Godot/Adapters/SqliteDataStore.cs",
      "logs/ci/<date>/security-audit.jsonl"
    ],
    "acceptance": [
      "SqliteDataStore 对传入路径在检查前统一规范化分隔符，严格限制为 user:// 前缀并拒绝任何包含 .. 或 ..\\\\ 的路径。",
      "SqliteDataStore 增加数据库文件扩展名白名单（如 .db/.sqlite/.sqlite3），非法扩展名会被拒绝并记录审计日志。",
      "针对已有数据库文件增加简单的大小上限检查（防 DoS），超限时抛出安全异常并写入 security-audit.jsonl。",
      "通过环境变量（例如 ALLOW_PLUGIN_BACKEND）或等价方案，将 plugin backend 限定在开发/实验环境，生产默认使用 managed backend，并在文档中明确记录。"
    ],
    "test_strategy": [
      "单元/集成测试：为 SqliteDataStore 增加路径与扩展名相关的测试用例，覆盖非法前缀、..、非法扩展名、超大文件等场景。",
      "安全审计：在启用/禁用 plugin backend 的不同配置下运行最小数据库操作，验证 security-audit.jsonl 中有预期的审计条目。"
    ],
    "taskmaster_exported": true,
    "taskmaster_id": 11,
    "contract_refs": [
      "security.file_access.denied"
    ]
  },
  {
    "id": "NG-0043",
    "story_id": "PH06-GAMELOOP-DB-ERROR-AND-AUDIT",
    "title": "GodotSQLiteDatabase 错误脱敏与审计挂钩",
    "description": "在 Game.Godot/Adapters/Db/GodotSQLiteDatabase 中按 ADR-0019 要求改造错误处理：开发环境保留详细异常信息方便排查；生产环境仅抛出脱敏后的通用错误消息，并将包含路径/SQL 明细的诊断信息写入安全审计日志或内部日志文件；同时为 OpenAsync/Execute* 等路径补充最小测试或 smoke 验证。",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "depends_on": [
      "NG-0042"
    ],
    "adr_refs": [
      "ADR-0019",
      "ADR-0006",
      "ADR-0005",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH02",
      "CH05",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [],
    "labels": [
      "security",
      "sqlite",
      "godot",
      "error-handling"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Godot/Adapters/Db/GodotSQLiteDatabase.cs",
      "logs/ci/<date>/security-audit.jsonl"
    ],
    "acceptance": [
      "GodotSQLiteDatabase 在 DEBUG 构建下仍然抛出包含路径/SQL 的详细异常，方便开发调试。",
      "在 Release/CI 环境下，同一代码路径仅向调用方暴露脱敏后的通用错误消息，详细路径与 SQL 片段被写入受控的审计/诊断日志。",
      "新增或扩展现有 smoke/集成测试，验证在数据库打开失败、SQL 执行失败等典型失败场景下，错误信息不会直接泄露敏感实现细节。"
    ],
    "test_strategy": [
      "环境对比测试：在 DEBUG 与 Release 配置下分别触发数据库异常，验证对调用方的异常消息差异以及 security-audit.jsonl 中的记录行为。",
      "CI 验证：在 windows-quality-gate 或等价工作流中加入一次最小化的 GodotSQLiteDatabase smoke 调用，确保改造后不会破坏现有管线。"
    ],
    "taskmaster_exported": true,
    "taskmaster_id": 12,
    "contract_refs": [
      "security.file_access.denied"
    ]
  },
  {
    "id": "NG-0044",
    "story_id": "PH13-GAMELOOP-OUTER-QUALITY-GATES",
    "title": "GameLoop 外圈质量门禁脚本与 Taskmaster 集成",
    "description": "围绕 GameLoop 与 SaveId/契约，补充一组外圈质量门禁脚本：例如 check_gameloop_contracts.py 用于校验 GameLoop 相关契约/事件是否与 Overlay 08 与 GuildContractsTests 同步；在 quality_gates.py 或独立脚本中汇总 GameLoop 安全/契约/测试结果，输出 logs/ci/<date>/gameloop-quality-guard.json，供 Taskmaster MCP 与人工 review 使用。",
    "status": "pending",
    "priority": "P3",
    "layer": "ci",
    "depends_on": [
      "NG-0040",
      "NG-0041"
    ],
    "adr_refs": [
      "ADR-0015",
      "ADR-0005",
      "ADR-0019",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH02",
      "CH06",
      "CH07",
      "CH09"
    ],
    "overlay_refs": [],
    "labels": [
      "quality-gates",
      "gameloop",
      "ci",
      "contracts"
    ],
    "owner": "architecture",
    "test_refs": [
      "scripts/python/check_gameloop_contracts.py",
      "logs/ci/<date>/gameloop-quality-guard.json"
    ],
    "acceptance": [
      "新增 scripts/python/check_gameloop_contracts.py 或等价脚本，能够扫描 GameLoop 相关契约/测试/Overlay 文档，并在发现不一致时给出结构化 JSON 报告。",
      "在 quality_gates.py 或独立 Python 脚本中聚合 SaveId 安全测试、GameLoop 合同测试与审计日志检查结果，输出 logs/ci/<date>/gameloop-quality-guard.json。",
      "Taskmaster 与 docs/workflows/task-master-superclaude-integration.md 中补充一小段说明：在进入 GameLoop 重大改动前建议先跑外圈质量门禁脚本，并将结果作为 PR review 的辅助参考，而非硬门禁。"
    ],
    "test_strategy": [
      "脚本级测试：在本地构造刻意破坏 GameLoop 契约/测试/Overlay 的分支，运行 check_gameloop_contracts.py 验证其能准确发现并报告问题。",
      "流程测试：在 CI 或本地通过 build_taskmaster_tasks.py + Taskmaster MCP 读取 gameloop-quality-guard.json，验证报告能被后续工作流消费。"
    ],
    "taskmaster_exported": false,
    "contract_refs": [
      "core.game_turn.started",
      "core.game_turn.phase_changed",
      "core.game_turn.week_advanced",
      "security.file_access.denied",
      "security.process.denied",
      "security.url_access.denied"
    ]
  },
  {
    "id": "NG-0045",
    "story_id": "PH06-GAMELOOP-AUDIT-WEEK-ADVANCED",
    "title": "GameLoop 周推进审计日志（F004）",
    "description": "对应安全审计发现 F004：GameTurnSystem.Advance() 发布 core.game_turn.week_advanced 等事件，但当前 SecurityAuditLogger 未将该关键节点写入 ADR-0019 规定的 security-audit.jsonl。该项为审计可追溯性/合规业务需求（不阻塞 T2），纳入 NG backlog。",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "depends_on": [
      "NG-0039"
    ],
    "adr_refs": [
      "ADR-0019",
      "ADR-0004",
      "ADR-0005",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH01",
      "CH02",
      "CH04",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [],
    "labels": [
      "security",
      "audit",
      "gameloop",
      "ng"
    ],
    "owner": "architecture",
    "test_refs": [
      "Game.Godot/Adapters/SecurityAuditLogger.cs",
      "logs/ci/<date>/security-audit.jsonl"
    ],
    "acceptance": [
      "在 CI/Release/secure 模式下，当产生周推进事件时，security-audit.jsonl 追加一条 ADR-0019 五字段 JSONL 记录（{ts, action, reason, target, caller}）。",
      "action 使用 core.game_turn.week_advanced（符合 ADR-0004 命名与 validate_audit_logs.py 的 domain.entity.verb 校验）。",
      "新增至少 1 条集成测试验证：推进一周后审计文件包含 action=core.game_turn.week_advanced 的条目，且不泄露绝对路径等敏感信息。"
    ],
    "test_strategy": [
      "集成测试：在 headless Godot 测试或等价 Runner 中触发 week advance，并校验 logs/ci/<date>/security-audit.jsonl 的条目。",
      "脚本验证：在 CI 中运行 scripts/python/validate_audit_logs.py --strict，确保新增条目持续合规。"
    ],
    "taskmaster_exported": false,
    "contract_refs": [
      "core.game_turn.week_advanced"
    ]
  }
]
